{% extends './base.html' %}

{% block title %}Register{% endblock %}

{% block customCSS %}
<!-- Estilos personalizados para el formulario de registro -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}">
{% endblock %}

{% block body %}
<form class="form-signup" action="/register" method="POST">
    <img class="mb-4" src="{{ url_for('static', filename='images/logo.png') }}" alt="" width="100" height="60">
    <h1 class="h3 mb-3 fw-normal">Register</h1>
            <a href="javascript:history.back()" class="btn-primary btn-lg"><</a>


    <!-- Campo de username -->
    <div class="form-floating mt-3">
        <input type="text" class="form-control" id="username" name="username" placeholder="Username" autocomplete="username" required>
        <label for="username">Username</label>
    </div>

    <!-- Campo de fullname -->
    <div class="form-floating mt-2">
        <input type="text" class="form-control" id="fullname" name="fullname" placeholder="Full Name" autocomplete="name">
        <label for="fullname">Nombre - Nombre Inmobiliaria</label>
    </div>
   
    <div class="form-floating mt-2">     
        <input type="email" class="form-control" name="correo" id="correo" placeholder="Email" required>
        <label for="correo">Correo:</label>
    </div>    

    <div class="form-floating mt-2">
        <input type="password" class="form-control" id="password" name="password" placeholder="Password" autocomplete="new-password" required>
        <label for="password">Contrasena</label>
    </div>
    

    <!-- Confirmar password -->
    <div class="form-floating mt-2">
        <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm Password" autocomplete="new-password" required>
        <label for="confirm_password">Confirmar Contrasena</label>
    </div>

    <button id="registrar" class="w-100 btn btn-lg btn-primary mt-3" type="submit">Registrarse</button>
</form>
 <!--<script>
    document.addEventListener('DOMContentLoaded', function () {
    var validar =  document.getElementById('registrar');  
    var fullname = document.getElementById('fullname').value.trim();
    
    var regex = /^([A-Za-z\s-]+) - ([A-Za-z\s-]+)$/;
    var match = fullname.match(regex);

    validar.addEventListener('submit', function(){
    if (!match) {
        alert('Ingrese el nombre de su inmobiliaria! "- Nombre Inmobiliaria".');
        event.preventDefault();
    } else {
        // Obtener el segundo grupo de regex que es el nombrepublisher
        var nombrepublisher = match[2].trim();
        var hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'nombrepublisher';
        hiddenInput.value = nombrepublisher;
        this.appendChild(hiddenInput);
    } });
    });
</script> -->

{% endblock %}
<!--1
from models.entities.User import User

class ModelUser:
    
    @classmethod
    def login(self, db, user):
        try:
            cursor = db.connection.cursor()
            sql = """SELECT id, username, password, fullname FROM user 
                    WHERE username = '{}'""".format(user.username)
            cursor.execute(sql)
            row = cursor.fetchone()
            if row != None:
                user = User(row[0], row[1], User.check_password(row[2], user.password), row[3])
                return user
            else:
                return None
        except Exception as ex:
            raise Exception(ex)

    @classmethod
    def get_by_id(self, db, id):
        try:
            cursor = db.connection.cursor()
            sql = "SELECT id, username, fullname FROM user WHERE id = {}".format(id)
            cursor.execute(sql)
            row = cursor.fetchone()
            if row != None:
                return User(row[0], row[1], None, row[2])
            else:
                return None
        except Exception as ex:
            raise Exception(ex)

    @staticmethod
    def register(db, user):
        cursor = db.connection.cursor()
        try:
            cursor.execute("INSERT INTO user (username, password, fullname) VALUES (%s, %s, %s)",
                           (user.username, user.password, user.fullname))
            db.connection.commit()
            return True
        except Exception as e:
            print(f"Error while registering user: {e}")
            db.connection.rollback()
            return False
        finally:
            cursor.close()

from werkzeug.security import generate_password_hash, check_password_hash
from flask_login import UserMixin

class User(UserMixin):
    
    def __init__(self, id, username, password, fullname=""):
        self.id = id
        self.username = username
        self.password = generate_password_hash(password, method='pbkdf2:sha256')
        self.fullname = fullname

    def check_password(self, password):
        return check_password_hash(self.password, password)


#print(generate_password_hash("suscribete"))
#python .\src\models\entities\User.py

   -->